
#include <iostream>
#include <stdlib.h>
#include <string.h>
#include <string>
#include <fstream>
#include <vector>
#include <random>
#include <conio.h>

using namespace std;


int FileLinesCount(string fileName) {
	
	int numLines = 0;
	ifstream in(fileName);
	string unused;
	while (getline(in, unused))
		++numLines;

	return numLines;
}

string GetLineFromFile (string fileName, int certainLine) {
	ifstream myFile;

	myFile.open(fileName, std::fstream::in);

	string line;
	int countLines = 1;
	while (getline(myFile, line)) {
		if (countLines == certainLine) {
			return line;
		}
		countLines++;
	}
	myFile.close();
}


vector<int> FindLinesEqualToString (string fileName, string searchedString) {
	
	vector<int> foundLines;
	ifstream myFile;
	myFile.open(fileName, std::fstream::in);
	string line;
	int countLines = 1;
	while (getline(myFile, line)) {
		if (line == searchedString) {
			foundLines.push_back(countLines);
		}
		countLines++;
	}
	myFile.close();

	return foundLines;
}

int RandomNumberFromVector(vector<int> vtr) {
	random_device random_device;
	mt19937 engine{ random_device() };
	uniform_int_distribution<int> dist(0, vtr.size() - 1);
	int randomElement = vtr[dist(engine)];

	return randomElement;
}

void HomeScreen(int &choice) {
	cout << "===================== Who wants to be a milionaire =====================" << endl;
	cout << "=========================== Bulgaria edition ===========================" << endl;
	cout << endl;
	cout << "                           1. New Game                                  " << endl;
	cout << "                           2. Add new question                          " << endl;
	cout << "                           3. Edit question                             " << endl;
	cout << "                           4. Exit                                      " << endl;
	cout << endl;
	cout << "========================================================================" << endl;
	cout << endl;
	cout << "Enter your choice here: "; 
	cin >> choice; 
	cout << endl;
}

void ChooseCategory(int& choice) {
	cout << "========================================================================" << endl;
	cout << endl;
	cout << "                       Choose a category:                               " << endl;
	cout << "                       1. Bulgarian history                             " << endl;
	cout << "                       2. Bulgarian geography                           " << endl;
	cout << "                       3. Bulgarian sport                               " << endl;
	cout << "                       4. All categories                                " << endl;
	cout << endl;
	cout << "========================================================================" << endl;
	cout << "Enter your choice here: ";
	cin >> choice;
	cout << endl;
}


void OutputQuestion(string level, string category, int &check) {
	system("cls");
	check = 1;
	string answerChoice;
	string fileName = "level" + level + ".txt";
	vector<int> a = FindLinesEqualToString(fileName, category);
	int rand = RandomNumberFromVector(a);
	cout << "========================================================================" << endl;
	for (int i = rand + 1; i < rand + 6; i++) cout << GetLineFromFile(fileName, i) << endl;
	cout << "========================================================================" << endl;
	cout << "Enter your choice here: ";
	cin >> answerChoice;
	cout << endl;
	string questionID = GetLineFromFile(fileName, rand - 1);
	string rightAnswer = GetLineFromFile("answers.txt", stoi(questionID));
	system("cls"); 
	if (answerChoice == rightAnswer) {
		cout << "========================================================================" << endl;
		cout << "                          Correct answer!                               " << endl;
		cout << "========================================================================" << endl;
		system("pause");
	}
	else {
		system("cls");
		cout << "========================================================================" << endl;
		cout << "                   Your answer was wrong.                               " << endl;
		cout << "         The correct answer was: "; 
		if (rightAnswer == "A") {
			cout << GetLineFromFile(fileName, rand + 2) << endl;
		}
		else if (rightAnswer == "B") {
			cout << GetLineFromFile(fileName, rand + 3) << endl;
		}
			else if (rightAnswer == "C") {
				cout << GetLineFromFile(fileName, rand + 4) << endl;
			}
		    	else {
			    	cout << GetLineFromFile(fileName, rand + 5) << endl;
				}
		cout << "========================================================================" << endl;

		check = 0;
	}
}

void OutputAllQuestions (string category) {
	int check = 1;
	int questionLevels[15] = { 1, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 9, 10 };
	int i = 0;
	do { OutputQuestion(to_string(questionLevels[i]), category, check); i++; } 
	while (check != 0);
}

int main()
{
	ChangeConsoleSize();
	int choice;
	HomeScreen(choice);
	if (choice == 4) {
		return 0;
	}
	
	if (choice == 1) {
		system("cls");
		int categoryChoice; string category;
		ChooseCategory(categoryChoice);
		system("cls");

		if (categoryChoice == 1) {
			category = "Bulgarian history";
		}
		else if (categoryChoice == 2) {
			category = "Bulgarian geography";
		}
		else if (categoryChoice == 3) {
			category = "Bulgarian sport";
		}

		OutputAllQuestions(category);
	}
	
	return 0;
}

